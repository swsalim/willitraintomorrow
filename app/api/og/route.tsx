import { ImageResponse } from 'next/og'
import { NextRequest } from 'next/server'

export const runtime = 'edge'

const font = fetch(
  new URL('../../../assets/fonts/CalSans-SemiBold.ttf', import.meta.url)
).then((res) => res.arrayBuffer())

export async function GET(req: NextRequest) {
  try {
    const fontData = await font
    const { searchParams } = new URL(req.url)
    // console.log(import.meta.url);

    // const logoData = await fetch(
    //   new URL('../../../images/logo-circle.png', import.meta.url)
    // )
    //   .then((res) => res.arrayBuffer())
    //   .then(
    //     (buf) => `data:image/jpeg;base64,${Buffer.from(buf).toString('base64')}`
    //   )

    const imageData = await fetch(
      new URL('../../../images/og-background.jpeg', import.meta.url)
    )
      .then((res) => res.arrayBuffer())
      .then(
        (buf) => `data:image/jpeg;base64,${Buffer.from(buf).toString('base64')}`
      )

    // ?title=<title>
    const hasTitle = searchParams.has('title')
    const title = hasTitle
      ? searchParams.get('title')?.slice(0, 100)
      : 'My default title'

    return new ImageResponse(
      (
        <div
          tw="h-full w-full flex items-center justify-center bg-gray-100"
          style={{ backgroundImage: `url(${imageData})` }}
        >
          <div tw="flex items-center justify-center h-full">
            <div tw="flex flex-col justify-center items-center w-full h-full p-20">
              {/* <div tw="bg-gray-50 rounded-full">
                <svg
                  version="1.0"
                  xmlns="http://www.w3.org/2000/svg"
                  width="100.000000pt"
                  height="100.000000pt"
                  viewBox="0 0 100.000000 100.000000"
                  preserveAspectRatio="xMidYMid meet"
                >
                  <g
                    transform="translate(0.000000,400.000000) scale(0.100000,-0.100000)"
                    fill="#001f3c"
                    stroke="none"
                  >
                    <path
                      d="M3005 3410 c3 -5 8 -10 11 -10 2 0 4 5 4 10 0 6 -5 10 -11 10 -5 0
-7 -4 -4 -10z"
                    />
                    <path
                      d="M3035 3410 c-3 -5 -1 -10 4 -10 6 0 11 5 11 10 0 6 -2 10 -4 10 -3 0
-8 -4 -11 -10z"
                    />
                    <path
                      d="M3085 3410 c-6 -9 11 -14 43 -13 7 1 12 -11 12 -27 0 -33 23 -45 44
-25 17 18 32 19 41 4 4 -6 0 -9 -11 -7 -25 4 -30 -29 -9 -52 10 -11 15 -28 12
-40 -3 -11 -1 -20 3 -20 5 0 15 -3 24 -6 9 -3 16 -1 16 6 0 6 -4 8 -10 5 -5
-3 -10 -3 -11 2 0 4 -3 20 -5 36 -3 15 0 35 5 45 9 15 11 15 12 -5 4 -60 16
-96 28 -89 4 3 7 -4 8 -14 1 -11 -2 -22 -8 -25 -5 -4 -9 -1 -9 4 0 6 -5 11
-11 11 -8 0 -8 -4 -1 -13 6 -7 14 -28 17 -47 7 -39 22 -61 22 -33 0 10 -5 21
-11 25 -6 4 3 10 22 14 17 4 32 11 32 17 0 22 11 -3 15 -34 3 -18 9 -37 15
-43 13 -13 13 -26 0 -26 -5 0 -10 6 -10 14 0 8 -5 18 -11 22 -7 4 -9 0 -5 -14
5 -16 3 -20 -11 -17 -10 2 -18 4 -18 5 0 1 -11 3 -25 6 -24 4 -24 3 -4 -9 12
-6 19 -18 17 -24 -6 -17 2 -16 21 3 9 9 16 11 16 4 0 -6 5 -8 10 -5 6 3 13 -1
16 -9 8 -21 24 -20 25 2 0 14 2 14 8 -3 6 -14 3 -23 -9 -30 -15 -8 -16 -12 -4
-22 16 -15 28 -17 19 -3 -3 6 -1 10 4 10 6 0 11 8 12 18 0 13 2 14 6 2 3 -8
11 -18 17 -22 7 -5 4 -8 -6 -8 -22 0 -23 -14 -3 -34 9 -8 15 -19 15 -23 0 -3
7 -8 16 -9 38 -6 46 -14 42 -43 -4 -29 -4 -29 23 -15 18 9 30 10 34 4 4 -6 3
-10 -2 -9 -21 4 -22 -3 -4 -23 11 -11 17 -26 14 -31 -3 -6 -10 -1 -14 11 -5
14 -17 22 -31 22 -13 0 -18 -4 -13 -8 6 -4 17 -16 25 -26 14 -18 13 -18 -10
-11 -21 7 -23 6 -13 -7 7 -8 10 -18 6 -21 -3 -4 -1 -7 5 -7 7 0 12 5 12 12 0
6 7 3 15 -8 14 -19 14 -19 11 1 -2 11 -1 14 1 8 3 -7 12 -13 21 -13 14 0 14
-2 3 -9 -7 -5 -11 -13 -8 -18 3 -5 -1 -23 -9 -39 -9 -17 -10 -24 -3 -17 10 10
16 8 30 -9 10 -11 16 -26 12 -32 -3 -6 -2 -7 3 -3 5 5 9 14 9 20 0 5 6 12 13
15 10 3 10 -3 -2 -27 -9 -17 -21 -32 -26 -32 -6 -1 -13 -2 -17 -3 -5 -1 -52
-23 -106 -48 -271 -130 -458 -366 -521 -659 -5 -25 -9 -26 -98 -32 -51 -4
-120 -13 -153 -22 -81 -22 -231 -96 -280 -138 l-39 -34 -50 39 c-111 88 -245
136 -403 145 -57 3 -103 7 -103 8 0 28 -38 185 -56 233 -59 157 -198 317 -334
385 -115 57 -184 71 -322 64 l-116 -5 -43 60 c-142 203 -356 339 -616 393 -91
19 -86 23 -158 -127 l-54 -113 92 -11 c116 -14 194 -37 277 -80 162 -84 298
-247 355 -422 14 -43 20 -52 34 -46 123 53 179 68 271 68 84 1 102 -3 155 -27
55 -26 125 -81 125 -98 0 -4 -17 -2 -37 4 -24 6 -288 12 -717 14 -556 4 -680
2 -687 -9 -5 -7 -9 -48 -9 -90 l0 -78 715 0 c789 0 754 3 813 -64 62 -71 117
-66 -743 -66 l-775 0 1 -32 c0 -18 4 -53 7 -78 l7 -45 995 -5 c890 -5 1000 -8
1042 -22 58 -21 129 -61 153 -88 18 -20 16 -20 -1068 -20 l-1087 0 0 -21 c0
-28 21 -100 33 -116 7 -10 196 -13 885 -13 l876 0 -74 -75 -74 -75 -778 0
c-428 0 -778 -2 -778 -5 0 -3 14 -36 31 -75 l32 -70 661 0 c421 0 655 -4 645
-10 -34 -20 -187 -72 -254 -87 -115 -25 -273 -19 -485 17 -169 29 -199 32
-352 28 -92 -2 -169 -6 -173 -9 -7 -8 27 -69 66 -120 l28 -36 158 -6 c98 -3
219 -16 318 -32 137 -23 179 -26 295 -22 152 6 190 15 433 101 209 74 320 96
484 96 163 0 264 -21 454 -93 297 -112 434 -128 699 -82 93 16 211 28 295 31
77 3 149 7 160 9 23 5 109 140 100 156 -4 5 -79 9 -174 9 -142 0 -189 -4 -307
-27 -114 -22 -167 -27 -294 -28 -170 0 -233 12 -375 74 l-70 30 631 1 631 0
32 70 c17 39 31 72 31 75 0 3 -354 5 -787 5 -839 0 -843 0 -1037 -50 -43 -12
-81 -18 -84 -15 -10 10 115 123 164 148 126 64 79 61 981 65 l822 3 15 54 c9
29 16 62 16 74 l0 21 -702 2 -702 3 55 37 c30 21 81 48 114 60 60 23 65 23
662 26 516 3 602 5 607 18 3 8 8 43 12 79 l7 65 -387 0 c-340 0 -386 2 -386
15 0 38 65 176 111 238 129 171 343 284 551 290 44 1 78 6 78 12 0 6 -11 53
-24 105 -81 318 -259 639 -479 867 l-51 53 -158 -1 c-89 0 -160 -4 -163 -9z
m125 -26 c0 -7 -11 -15 -25 -18 -17 -4 -23 -11 -19 -19 5 -8 4 -9 -4 -2 -20
18 -3 53 24 51 13 0 24 -6 24 -12z m10 -74 c0 -5 -4 -10 -10 -10 -5 0 -10 5
-10 10 0 6 5 10 10 10 6 0 10 -4 10 -10z m60 -10 c0 -5 -4 -10 -10 -10 -5 0
-10 5 -10 10 0 6 5 10 10 10 6 0 10 -4 10 -10z m27 -62 c-3 -8 -6 -5 -6 6 -1
11 2 17 5 13 3 -3 4 -12 1 -19z m47 -2 c-6 -16 -24 -13 -24 5 0 6 5 7 10 4 6
-3 10 -1 10 6 0 7 2 10 5 7 3 -3 3 -13 -1 -22z m-14 -41 c0 -8 -3 -14 -7 -14
-21 3 -33 -3 -33 -17 0 -8 -4 -12 -10 -9 -20 13 -3 33 48 54 1 1 2 -6 2 -14z
m110 -139 c0 -2 -7 -7 -16 -10 -8 -3 -12 -2 -9 4 6 10 25 14 25 6z m100 -156
c0 -5 -7 -7 -15 -4 -8 4 -15 8 -15 10 0 2 7 4 15 4 8 0 15 -4 15 -10z m70
-140 c0 -5 -2 -10 -4 -10 -3 0 -8 5 -11 10 -3 6 -1 10 4 10 6 0 11 -4 11 -10z
m15 -40 c3 -5 -1 -10 -9 -10 -8 0 -18 5 -21 10 -3 6 1 10 9 10 8 0 18 -4 21
-10z m35 -11 c0 -5 -4 -9 -10 -9 -5 0 -10 7 -10 16 0 8 5 12 10 9 6 -3 10 -10
10 -16z m-22 -28 c10 -6 7 -10 -12 -13 -28 -6 -45 7 -24 15 19 8 22 8 36 -2z
m32 -43 c0 6 5 12 12 12 8 0 7 -6 -4 -16 -17 -17 -43 -10 -32 8 4 6 10 5 15
-3 6 -10 9 -11 9 -1z"
                    />
                    <path
                      d="M510 3331 c-62 -68 -170 -209 -170 -220 0 -3 240 -5 532 -3 494 3
535 4 558 21 38 28 48 65 26 105 -10 19 -29 39 -42 45 -16 7 -93 11 -204 11
l-179 0 -17 36 c-32 67 -55 74 -261 74 l-182 0 -61 -69z"
                    />
                    <path
                      d="M3056 3382 c-3 -5 1 -9 9 -9 8 0 15 4 15 9 0 4 -4 8 -9 8 -6 0 -12
-4 -15 -8z"
                    />
                    <path
                      d="M3117 3353 c-10 -10 -8 -43 2 -43 6 0 13 5 16 10 3 6 2 10 -4 10 -6
0 -8 7 -5 15 6 16 2 20 -9 8z"
                    />
                    <path d="M3140 3300 c-9 -6 -10 -10 -3 -10 6 0 15 5 18 10 8 12 4 12 -15 0z" />
                    <path
                      d="M3178 3272 c9 -11 21 -17 26 -14 5 3 1 11 -9 19 -27 19 -38 16 -17
-5z"
                    />
                    <path
                      d="M3140 3248 c-10 -21 -10 -22 3 -5 11 14 16 15 20 5 4 -9 6 -9 6 -1 2
23 -18 23 -29 1z"
                    />
                    <path
                      d="M3205 3187 c-18 -14 -13 -38 8 -36 9 0 9 2 0 6 -21 8 -14 25 7 18 15
-5 18 -3 14 9 -7 19 -6 19 -29 3z"
                    />
                    <path
                      d="M3233 3144 c-17 -18 -16 -27 2 -20 8 3 19 -2 24 -12 6 -9 11 -12 11
-5 0 6 -5 15 -10 18 -6 4 -8 10 -5 15 9 15 -9 19 -22 4z"
                    />
                    <path
                      d="M3313 3114 c-9 -24 11 -36 24 -15 10 16 9 20 -3 25 -8 3 -17 -1 -21
-10z"
                    />
                    <path d="M3320 3025 c0 -2 9 -9 20 -15 16 -9 18 -8 14 5 -5 13 -34 22 -34 10z" />
                    <path d="M3327 2974 c2 -6 11 -11 18 -10 26 4 26 13 1 18 -16 3 -23 1 -19 -8z" />
                    <path
                      d="M2693 2945 c-14 -11 -19 -33 -24 -112 -6 -105 -18 -138 -71 -198 -38
-44 -91 -72 -160 -85 -110 -21 -238 41 -293 142 -23 42 -29 68 -32 133 -6 118
-8 125 -43 125 -83 0 -102 -181 -36 -327 34 -72 111 -147 194 -186 62 -29 75
-32 167 -32 92 0 105 3 166 32 80 39 159 120 197 200 24 52 27 70 27 164 0 89
-3 110 -18 127 -24 27 -52 33 -74 17z"
                    />
                    <path
                      d="M3389 2943 c-13 -16 -12 -17 2 -5 14 10 17 9 22 -7 2 -11 0 -24 -6
-30 -8 -8 -8 -11 1 -11 12 0 16 13 12 40 -3 26 -16 31 -31 13z"
                    />
                    <path
                      d="M3453 2883 c9 -11 14 -24 10 -28 -5 -5 -1 -4 8 3 9 6 19 9 22 6 3 -4
5 3 4 15 -1 13 -5 17 -11 11 -6 -6 -17 -5 -30 2 -20 11 -20 10 -3 -9z"
                    />
                    <path
                      d="M3435 2860 c3 -5 8 -10 11 -10 2 0 4 5 4 10 0 6 -5 10 -11 10 -5 0
-7 -4 -4 -10z"
                    />
                    <path
                      d="M3471 2828 c-1 -10 6 -18 14 -18 8 0 15 5 15 11 0 5 -4 8 -9 5 -5 -4
-12 0 -14 6 -3 8 -6 6 -6 -4z"
                    />
                    <path
                      d="M3480 2776 c0 -8 4 -17 8 -20 4 -2 8 4 8 15 0 10 -4 19 -8 19 -4 0
-8 -6 -8 -14z"
                    />
                    <path d="M3461 2734 c0 -11 3 -14 6 -6 3 7 2 16 -1 19 -3 4 -6 -2 -5 -13z" />
                    <path
                      d="M3531 2727 c2 -1 12 -9 22 -16 14 -12 17 -11 17 3 0 10 -8 16 -22 16
-12 0 -19 -1 -17 -3z"
                    />
                    <path
                      d="M3520 2669 c0 -5 5 -7 10 -4 6 3 10 8 10 11 0 2 -4 4 -10 4 -5 0 -10
-5 -10 -11z"
                    />
                    <path
                      d="M3555 2620 c-3 -5 -1 -10 4 -10 6 0 11 5 11 10 0 6 -2 10 -4 10 -3 0
-8 -4 -11 -10z"
                    />
                    <path
                      d="M1856 765 c-78 -15 -139 -35 -406 -131 l-135 -49 -365 3 -364 3 19
-22 c11 -12 53 -51 94 -85 l74 -64 242 0 c297 0 347 8 583 96 214 80 285 95
432 96 147 0 221 -17 425 -97 219 -87 266 -95 537 -95 257 0 239 -5 353 104
l70 66 -265 -6 c-379 -9 -400 -6 -714 116 -60 23 -139 48 -175 56 -101 22
-310 27 -405 9z"
                    />
                    <path
                      d="M1940 353 c-80 -8 -167 -25 -243 -49 -80 -25 -394 -151 -410 -164 -7
-6 154 -64 206 -74 18 -3 51 7 100 29 181 83 403 114 582 80 80 -15 192 -52
295 -98 34 -15 39 -14 133 18 54 18 103 37 108 42 6 6 -42 32 -133 72 -221 97
-325 129 -459 141 -63 5 -121 9 -129 8 -8 -1 -31 -3 -50 -5z"
                    />
                  </g>
                </svg>
              </div> */}
              <div tw="flex flex-col items-center">
                <h1 tw="text-7xl text-gray-900 font-bold text-center mb-0 leading-tight text-[#1F3C4A] capitalize">
                  {title}
                </h1>
                <p tw="text-gray-700 font-semibold capitalize mt-4 text-xl text-center text-[#1F3C4A]">
                  willitraintomorrow.com
                </p>
              </div>
            </div>
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 630,
        fonts: [
          {
            name: 'Cal Sans',
            data: fontData,
            style: 'normal',
          },
        ],
      }
    )
  } catch (e: any) {
    console.log(`${e.message}`)
    return new Response(`Failed to generate the image`, {
      status: 500,
    })
  }
}
